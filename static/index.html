<!DOCTYPE html>
<html>
    <head>
        <title>App.Net Word Cloud</title>
        <link rel="stylesheet" type="text/css" href="/static/css/jqcloud.css" />
        <link rel="stylesheet" type="text/css" href="/static/css/page.css" />
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
        <script type="text/javascript" src="/static/scripts/jqcloud-1.0.3.min.js"></script>
        <script type="text/javascript">
            
            var browserWidth = 0;
            var browserHeight = 0;
            // Thanks, StackOverflow: http://stackoverflow.com/a/3945897/1217087
            function getSize() {
                if( typeof( window.innerWidth ) == 'number' )
                {
                    //Non-IE
                    isIE = false;
                    browserWidth = window.innerWidth;
                    browserHeight = window.innerHeight;
                } else if( document.documentElement && ( document.documentElement.clientWidth || document.documentElement.clientHeight ) ) {
                    //IE 6+ in 'standards compliant mode'
                    browserWidth = document.documentElement.clientWidth;
                    browserHeight = document.documentElement.clientHeight;
                } else if( document.body && ( document.body.clientWidth || document.body.clientHeight ) ) {
                    
                    //They're not running IE7 / FireFox2. Older browser. Find some technology
                    //to destroy their computer so they're forced to upgrade.
                    browserWidth = document.body.clientWidth;
                    browserHeight = document.body.clientHeight;
                }
            }
            
            var word_array = [];
            var drawing = false;
            
            function drawCloud() {
                if (drawing) return;
                drawing = true;
                getSize();
                $("#cloud").html('');
                $("#cloud").jQCloud(word_array, {
                                    width: browserWidth * 0.8,
                                    height: browserHeight * 0.8,
                                    delayedMode: true,
                                    afterCloudRender: function() { drawing = false; }});
            }
            
            $.getJSON(
                      '/wc',
                      function (data) {
                      for(var i = 0; i < data.length; i++){
                      word_array.push({
                                      text: data[i][0],
                                      weight: data[i][1],
                                      html: {
                                      title: data[i][0] + ": " + data[i][1] + " occurrences."
                                      }})
                      };
                      drawCloud(word_array);
                      });
            
            // Only re-draw when the window has finished resizing.
            $(window).resize(function() {
                             clearTimeout(this.id);
                             this.id = setTimeout(drawCloud, 100);
                             });
            
            </script>
        
    </head>
    <body>
        <div id="header">

            <ul>
                <li>Words</li>
                <li>Mentions</li>
                <li>Hashtags</li>
                <li>Links</li>
            </ul>

        </div>
        <div id="cloud" style="width: 550px; height: 350px;"></div>
        <div id="footer">
            <ul>
                <li><a href="/about">About</a></li>
                <li><a href="https://github.com/adamsp/adnwc">Github</a></li>
                <li><a href="https://twitter.com/adamsnz">Twitter</a></li>
                <li><a href="https://alpha.app.net/global/">ADN Global Stream</a></li>
            </ul>
        </div>
    </body>
</html>

